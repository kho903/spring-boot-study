# 09. 프로메테우스 - 게이지와 카운터
- 메트릭은 크게 보면 게이지와 카운터라는 2가지로 분류 가능.

## 게이지 (Gauge)
- 임의로 오르내릴 수 있는 값
- 예) CPU 사용량, 메모리 사용량, 사용중인 커넥션

## 카운터 (Counter)
- 단순하게 증가하는 단일 누적 값
- 예) HTTP 요청 수, 로그 발생 수


- 쉽게 이야기해서 게이지는 오르락 내리락 하는 값이고, 카운터는 특정 이벤트가 발생할 때마다 그 수를 계속 누적하는 값.

## 게이지 (Gauge)
- 게이지는 오르고 내리고 하는 값. 게이지는 현재 상태를 그대로 출력하면 됨.
- 예를 들어서 대표적인 게이지인 CPU 사용량(`system_cpu_usage`)을 생각해보자. CPU 사용량의 현재 상태를 계속 측정하고 그 값을 그대로 그래프에 출력하면
과거부터 지금까지의 CPU 사용량을 확인할 수 있음.
- 게이지는 가장 단순하고 사용하기 쉬운 메트릭. 크게 고민하지 않고 있는 그대로를 사용하면 됨.

## 카운터 (Counter)
- 카운터는 단순하게 증가하는 단일 누적 값. 예를 들어서 고객의 HTTP 요청수를 떠올려 보면 바로 이해가 될 것.
- HTTP 요청을 그래프로 표현해보자.

### 계속 증가하는 그래프
- 예) http_server_requests_seconds_count{uri="/log"}
- HTTP 요청 메트릭을 그래프로 표현해보면 카운터는 계속 누적해서 증가하는 값. 따라서 계속 증가하는 그래프만 보게 될 것임. 이렇게 증가만 하는 그래프에서는 특정
시간에 얼마나 고객의 요청이 들어왔는지 한 눈에 확인하기 매우 어렵. 이런 문제를 해결하기 위해 `increase()`, `rate()` 같은 함수를 지원함.

### increase()
- `increase()`를 사용하면 이런 문제를 해결할 수 있음. 지정한 시간 단위별로 증가를 확인할 수 있음.
- 마지막에 `[시간]`을 사용해서 범위 벡처를 선택해야 함.
- 예) `increase(http_server_requests_seconds_count{uri="/log"}[1m])`
- 분당 얼마나 고객의 요청이 어느정도 증가했는지 한눈에 파악 가능.

### rate()
- 범위 벡터에서 초당 평균 증가율을 계산함.
- `increase()`가 숫자를 직접 카운트 한다면, `rate()`는 여기에 초당 평균을 나누어서 계산함.
- `rage(data[1m])`에서 `[1m]`이라고 하면 60초가 기준이 되므로 60을 나눈 수.
- `rage(data[2m])`에서 `[1m]`이라고 하면 120초가 기준이 되므로 120을 나눈 수.
- 너무 복잡하게 생각하기 보다는 초당 얼마나 증가하는지 나타내는 지표로 보면 됨.

### irate()
- `rate()`와 유사한데, 범위 벡터에서 초당 순간 증가율을 계산함. 급격하게 증가한 내용을 확인하기 좋음.

## 정리
- 게이지 : 값이 계속 변하는 게이지는 현재 값을 그대로 그래프로 표현하면 됨.
- 카운터 : 값이 단조롭게 증가하는 카운터는 `increase()`, `rate()`등을 사용해서 표현하면 됨. 이렇게 하면 카운터에서 특정 시간에 얼마나 고객의 요청이
들어왔는지 확인 가능.

### 참고
- 프로메테우스 공식 메뉴얼
- 기본 기능 : https://prometheus.io/docs/prometheus/latest/querying/basics/
- 연산자 : https://prometheus.io/docs/prometheus/latest/querying/operators/
- 함수 : https://prometheus.io/docs/prometheus/latest/querying/functions/


- 프로메테우스의 단점은 한눈에 들어오는 대시보드를 만들어보기 어렵다는 점. 이 부분은 그라파나를 사용하면 됨.

